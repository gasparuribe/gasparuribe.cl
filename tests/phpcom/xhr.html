<html><head></head><body>
    <h3>Synchronous requests</h3>
    <pre><div id="synchronous_response"></div></pre>
    <hr>
    <h3>Asynchronous requests</h3>
    <pre><div id="asynchronous_response"></div></pre>
    <hr>
    <h3>Other requests</h3>
    <div><pre id="other_response"></pre></div>
    <hr>
    Ultima modificacion de gaspar.github.io: <br><span id="date"></span>
<script>
//INFO -  https://javascript.info/xmlhttprequest
function SynchronousGet(TheUrl,SendData){
    var returnText= {
      "status": "Error",
      "why": "notsure",
    };
    var xhr = new XMLHttpRequest();
    xhr.open('POST', TheUrl, false);
    try {
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr.send(SendData);
        if (xhr.status != 200) { // analyze HTTP status of the response
            //console.log(`Error connecting host ${xhr.status}: ${xhr.statusText}`); // e.g. 404: Not Found
            returnText= {
              "status": "Error",
              "why": "in xhr.status",
            };
        } else { // show the result
            console.log(`Connected to host, got ${xhr.response.length} bytes`); // response is the server response
            returnText=xhr.responseText;
        }
    } catch(err) {
        console.log("Error con SynchronousGet: "+err);
        returnText= {
          "status": "Error",
          "why": "No fue posible conectar al servidor",
        };
    }
    return returnText;
}


function AsynchronousGet(TheUrl,SendData,Method){
     var returnText= {
      "status": "Error",
      "why": "notsure",
    };
    const xhr = new XMLHttpRequest();
    xhr.open(Method, TheUrl, true);
    xhr.onreadystatechange = function () {
         if (xhr.readyState == 4) {
            console.log("onreadystatechange: 4 LetsGOOOO");
        }else{
            console.log("onreadystatechange: "+xhr.readyState);
            //4=finished (show one time)
            //3=loading (show one or multiple times)
            //2=HEADERS_RECEIVED  (show one time)
            //1=OPENED (show one time)
            //0=UNSENT (show if fail)
        }
    };
    xhr.onload = () => {
      if (xhr.status != 200) { // analyze HTTP status of the response
        console.log(`onload Error ${xhr.status}: ${xhr.statusText}`); // e.g. 404: Not Found
      } else { // show the result
        console.log(`onload Done, got ${xhr.response.length} bytes`); // response is the server response
        returnText=xhr.responseText;
        console.log("end call:" +returnText);
      }
    };
    xhr.onerror = function() { // only triggers if the request couldn't be made at all
       console.log("onerror");
       returnText= {
          "status": "Error",
          "why": "onerror",
        };
    };
    xhr.onprogress = function(event) { // triggers periodically
      // event.loaded - how many bytes downloaded
      // event.lengthComputable = true if the server sent Content-Length header
      // event.total - total number of bytes (if lengthComputable)
      if (event.lengthComputable) {
        console.log(`onprogress: received ${event.loaded} of ${event.total} bytes`);
      } else {
        console.log(`onprogress: received ${event.loaded} bytes`); // no Content-Length y/o se envio todo
      }
    };
    xhr.ontimeout = (e) => {
        console.log("ontimeout");
    };
    try {
        xhr.send(null);
    } catch(err) { // instead of onerror
      console.log("Request failed");
        returnText= {
          "status": "Error",
          "why": "trycatch",
        };
    }
    return;
}
console.log("SynchronousGet host PHP->JSON TEST");
console.log("Desactivado por error de header que no lo toma el try catch");
var syncDiv=document.getElementById("synchronous_response");
/*
var json_obj = JSON.parse(SynchronousGet( 'https://gasparuribe.000webhostapp.com/json.php','action=server_check&other=random'));
syncDiv.innerHTML = JSON.stringify(json_obj, (key, value) => (value || ''), 4).replace(/"([^"]+)":/g, '$1:')+'<br>';

var json_obj = JSON.parse(SynchronousGet( 'https://gasparuribe.000webhostapp.com/json.php','action=demo&other=random'));
syncDiv.insertAdjacentHTML(
  'beforeend', JSON.stringify(json_obj, (key, value) => (value || ''), 4).replace(/"([^"]+)":/g, '$1:')+'<br>'
);

var json_obj = JSON.parse(SynchronousGet( 'https://gasparuribe.000webhostapp.com/json.php','action=fail&other=random'));
syncDiv.insertAdjacentHTML(
  'beforeend', JSON.stringify(json_obj, (key, value) => (value || ''), 4).replace(/"([^"]+)":/g, '$1:')+'<br>'
);

var json_obj = JSON.parse(SynchronousGet( 'https://gasparuribe.000webhostapp.com/json.php','other=random'));
 syncDiv.insertAdjacentHTML(
  'beforeend', JSON.stringify(json_obj, (key, value) => (value || ''), 4).replace(/"([^"]+)":/g, '$1:')+'<br>'
);
*/
console.log("SynchronousGet FAKEHOST ERRIR TEST");
var json_obj1 = SynchronousGet( 'https://randomurl.dgfsdgfsdgsfdgfsgdhsdgsfsdhfdfhshfdgfdgdgdfdgsfgdsfdfgdgfdsggdsdgsfdsfgsaergjdty456453564.com/json.php','action=server_check&other=random' );
document.getElementById("other_response").innerHTML = JSON.stringify(json_obj1, (key, value) => (value || ''), 4).replace(/"([^"]+)":/g, '$1:');
console.log("END SynchronousGet");
console.log("----------------------------------------");
console.log("AsynchronousGet TEST");
var asyncDiv=document.getElementById("asynchronous_response");
var json_obj_async = AsynchronousGet( 'https://www.reddit.com/user/cookiesonder/new.json','sort=new','GET' );
asyncDiv.insertAdjacentHTML('beforeend',JSON.stringify(json_obj_async, (key, value) => (value || ''), 4).replace(/"([^"]+)":/g, '$1:'));
console.log("END AsynchronousGet");





    var xhttp = new XMLHttpRequest();
    xhttp.onload = () => {
      if (xhttp.status != 200) { // analyze HTTP status of the response
        console.log(`onload Error ${xhttp.status}: ${xhttp.statusText}`); // e.g. 404: Not Found
      } else { // show the result
        console.log(`onload Done, got ${xhttp.response.length} bytes`); // response is the server response
      }
    };
    xhttp.onerror = function() { // only triggers if the request couldn't be made at all
       console.log("onerror");
    };
    xhttp.onprogress = function(event) { // triggers periodically
      // event.loaded - how many bytes downloaded
      // event.lengthComputable = true if the server sent Content-Length header
      // event.total - total number of bytes (if lengthComputable)
      if (event.lengthComputable) {
        console.log(`Received ${event.loaded} of ${event.total} bytes`);
      } else {
        console.log(`Received ${event.loaded} bytes`); // no Content-Length
      }
    };
    xhttp.onreadystatechange = function(){
      if (this.readyState == 4 && this.status == 200){
        let repos = JSON.parse(this.responseText);
        repos.forEach((repo)=>{
          console.log('github: '+repo.name);
          if (repo.name == "gasparuribe.github.io"){
            var lastUpdated = new Date(repo.updated_at);
            var lastPush = new Date(repo.pushed_at);
            console.log(`Up11: ${lastUpdated}`);
            console.log(`Up12: ${repo.updated_at}`);
            console.log(`Up21: ${lastPush}`);
            console.log(`Up22: ${repo.pushed_at}`);
            var min = lastPush.getUTCMinutes();
            var hour = lastPush.getUTCHours()-3;
            var day = lastPush.getUTCDate();
            var month = lastPush.getUTCMonth();
            var year = lastPush.getUTCFullYear();
            document.getElementById("date").innerHTML=`Ultimo Cambio: ${year}/${month}/${day}  ${hour}:${min}`;
          }
        });
      }
    };
    //https://api.github.com/repos/gasparuribe/gasparuribe.github.io/branches/main
    xhttp.open("GET", "https://api.github.com/users/gasparuribe/repos", true);
    xhttp.send();




</script>
</body>
</html>
